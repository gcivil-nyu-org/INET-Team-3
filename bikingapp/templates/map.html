{% extends 'base.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    {% load static %}
    <link rel="stylesheet" href="{% static '/css/base.css' %}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <title>Maps</title>
</head>

<body>
    {% block content %}
        <div id="map" style="height: 600px; width: 75%; margin-top: 150px; margin-left: 10%;"></div>
        <div style="margin-top: 15px; margin-left: 10%;">
            <button type="button" id="btn1" class="btn btn-primary">Bike Lanes</button>
            <button type="button" id="btn2" class="btn btn-secondary">Bike Parking</button>
            <button type="button" id="btn3" class="btn btn-secondary">Bike Collisions</button>
        </div>
        <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlkwD4oZWgdqKf-wptm3M1cepVjtVUM-U&callback=initMap&v=weekly"
        async defer
        >
        </script>
        <script>
            const btn1 = document.getElementById('btn1');
            const btn2 = document.getElementById('btn2');
            const btn3 = document.getElementById('btn3');

            btn1.addEventListener('click', function onClick() {
                btn1.classList.remove("btn-secondary");
                btn1.classList.add("btn-primary");
                btn2.classList.remove("btn-primary");
                btn3.classList.remove("btn-primary");
                btn2.classList.add("btn-secondary");
                btn3.classList.add("btn-secondary");

                const uluru = { lat: 40.7237, lng: -73.9898 };

                map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: uluru,
                });

                const bikeLayer = new google.maps.BicyclingLayer();
                bikeLayer.setMap(map);
            });

            btn2.addEventListener('click', function onClick() {
                btn2.classList.remove("btn-secondary");
                btn2.classList.add("btn-primary");
                btn1.classList.remove("btn-primary");
                btn3.classList.remove("btn-primary");
                btn1.classList.add("btn-secondary");
                btn3.classList.add("btn-secondary");

                const uluru = { lat: 40.7237, lng: -73.9898 };
        
                map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: uluru,
                });
                map.data.loadGeoJson("{% static 'json/bikeparking.geojson' %}");
                
                //map.data.setStyle(function(feature) {
                //    return{
                //        icon: getCircle(),

                //    }
                //});
        
            });

            btn3.addEventListener('click', function onClick() {
                btn3.classList.remove("btn-secondary");
                btn3.classList.add("btn-primary");
                btn1.classList.remove("btn-primary");
                btn2.classList.remove("btn-primary");
                btn1.classList.add("btn-secondary");
                btn2.classList.add("btn-secondary");

                const uluru = { lat: 40.7237, lng: -73.9898 };
        
                map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: uluru,
                });
                map.data.loadGeoJson("{% static 'json/bikeCollisions.geojson' %}");
                
                // const iconBase = "https://cdn-skill.splashmath.com/panel-uploads/GlossaryTerm/8bc0a422674548a48e2500b880628b91/1544077479_Circle-Shape.png";

                //map.data.setStyle(function(feature) {
                //    return{
                //        icon: getCircle(),

                //    }
                //});

                var infowindow = new google.maps.InfoWindow();
                map.data.addListener('click', function(event){
                    let date = event.feature.getProperty("CRASH DATE");
                    let time = event.feature.getProperty("CRASH TIME");
                    let borough = event.feature.getProperty("BOROUGH");
                    let zip = event.feature.getProperty("ZIP CODE");
                    let numKilled = event.feature.getProperty("NUMBER OF CYCLIST KILLED");
                    let numInjured = event.feature.getProperty("NUMBER OF CYCLIST INJURED");

                    let html = '<b>Crash Date:</b> ' + date + '<br>' +
                                '<b>Crash Time (military time):</b> ' +  time + '<br>' +
                                '<b>Borough:</b> ' + borough + '<br>' +
                                '<b>Zipcode:</b> ' +  zip + '<br>' +
                                '<b>Cyclists Injured:</b> ' + numInjured + '<br>' +
                                '<b>Cyclists Killed:</b> ' +  numKilled + '<br>';
                    infowindow.setContent(html);
                    infowindow.setPosition(event.latLng);
                    infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
                    infowindow.open(map);
                });

            });
          
        function initMap() {

        const uluru = { lat: 40.7237, lng: -73.9898 };

        map = new google.maps.Map(document.getElementById("map"), {
        zoom: 9,
        center: uluru,
        });

        const marker = new google.maps.Marker({
        position: uluru,
        map: map,
        });

        const bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);
        }

        function getCircle() {
            return {
                path: google.maps.SymbolPath.CIRCLE,
                fillColor: "red",
                fillOpacity: 0.2,
                scale: 2,
                strokeColor: "white",
                strokeWeight: 0.5,
            };
        }

        </script>
    {% endblock content %}
</body>

</html>